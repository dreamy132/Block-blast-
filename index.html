<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon.png">

<style>
body {
  font-family: Arial, sans-serif;
  background: #121212;
  color: white;
  text-align: center;
  margin: 0;
}

h1 { margin-top: 15px; }

#board {
  display: grid;
  grid-template-columns: repeat(8, 42px);
  gap: 5px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 42px;
  height: 42px;
  background: #2a2a2a;
  border-radius: 8px;
}

.filled {
  background: #00d4ff;
}

#pieces {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin: 20px;
}

.piece {
  display: grid;
  gap: 4px;
}

.block {
  width: 22px;
  height: 22px;
  background: #ff9800;
  border-radius: 5px;
}

button {
  padding: 8px 15px;
  border-radius: 8px;
  border: none;
  margin-top: 10px;
  font-size: 16px;
}
</style>
</head>

<body>

<h1>Block Blast</h1>
<h2>Score: <span id="score">0</span></h2>

<div id="board"></div>
<div id="pieces"></div>
<button onclick="restart()">Restart</button>

<script>
document.addEventListener("DOMContentLoaded", function () {

const size = 8;
let board = [];
let score = 0;
let selected = null;

const shapes = [
  [[1,1],[1,1]],
  [[1,1,1]],
  [[1],[1],[1]],
  [[1,1,1],[0,1,0]],
  [[1,0],[1,0],[1,1]],
  [[1,1,1,1]]
];

function init() {
  const boardDiv = document.getElementById("board");
  boardDiv.innerHTML = "";
  board = [];

  for (let r=0;r<size;r++){
    board[r]=[];
    for(let c=0;c<size;c++){
      board[r][c]=0;
      const cell=document.createElement("div");
      cell.className="cell";
      cell.onclick=()=>tryPlace(r,c);
      boardDiv.appendChild(cell);
    }
  }

  draw();
  generatePieces();
}

function draw(){
  const cells=document.querySelectorAll(".cell");
  cells.forEach((cell,i)=>{
    const r=Math.floor(i/size);
    const c=i%size;
    cell.classList.toggle("filled",board[r][c]);
  });
}

function generatePieces(){
  const container=document.getElementById("pieces");
  container.innerHTML="";
  for(let i=0;i<3;i++){
    const shape=shapes[Math.floor(Math.random()*shapes.length)];
    const div=document.createElement("div");
    div.className="piece";
    div.style.gridTemplateColumns=`repeat(${shape[0].length},22px)`;

    shape.forEach(row=>{
      row.forEach(cell=>{
        const block=document.createElement("div");
        block.className="block";
        if(!cell) block.style.visibility="hidden";
        div.appendChild(block);
      });
    });

    div.onclick=()=>selected={shape,el:div};
    container.appendChild(div);
  }
}

function canPlace(shape,row,col){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[0].length;c++){
      if(shape[r][c]){
        if(row+r>=size||col+c>=size||board[row+r][col+c])
          return false;
      }
    }
  }
  return true;
}

function tryPlace(row,col){
  if(!selected) return;
  if(!canPlace(selected.shape,row,col)) return;

  selected.shape.forEach((r,i)=>{
    r.forEach((val,j)=>{
      if(val) board[row+i][col+j]=1;
    });
  });

  selected.el.remove();
  selected=null;

  clearLines();
  draw();

  if(document.querySelectorAll(".piece").length===0)
    generatePieces();
}

function clearLines(){
  let cleared=0;

  for(let r=0;r<size;r++){
    if(board[r].every(v=>v)){
      board[r]=Array(size).fill(0);
      cleared++;
    }
  }

  for(let c=0;c<size;c++){
    let full=true;
    for(let r=0;r<size;r++)
      if(!board[r][c]) full=false;

    if(full){
      for(let r=0;r<size;r++)
        board[r][c]=0;
      cleared++;
    }
  }

  if(cleared){
    score+=cleared*10;
    document.getElementById("score").textContent=score;
  }
}

window.restart=function(){
  score=0;
  document.getElementById("score").textContent=0;
  init();
}

init();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

});
</script>

</body>
</html>
