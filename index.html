<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon.png">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: white;
  text-align: center;
  margin: 0;
}

h1 { margin-top: 15px; }

#board {
  display: grid;
  grid-template-columns: repeat(8, 42px);
  gap: 6px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 42px;
  height: 42px;
  background: #1f1f1f;
  border-radius: 8px;
  transition: 0.2s;
}

.filled {
  background: #00e5ff;
  box-shadow: 0 0 8px #00e5ff;
}

#pieces {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin: 20px;
}

.piece {
  display: grid;
  gap: 4px;
  cursor: pointer;
}

.block {
  width: 22px;
  height: 22px;
  background: #ff9800;
  border-radius: 5px;
}

#gameOverScreen {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

button {
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  margin-top: 15px;
  font-size: 16px;
  background: #00e5ff;
}
</style>
</head>

<body>

<h1>Block Blast</h1>
<h2>Score: <span id="score">0</span></h2>
<h3>High Score: <span id="highScore">0</span></h3>

<div id="board"></div>
<div id="pieces"></div>

<div id="gameOverScreen">
  <h2>Game Over</h2>
  <p>Final Score: <span id="finalScore"></span></p>
  <button onclick="restart()">Play Again</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

const size = 8;
let board = [];
let score = 0;
let selected = null;
let highScore = localStorage.getItem("bb_high") || 0;
document.getElementById("highScore").textContent = highScore;

const shapes = [
  [[1,1],[1,1]],
  [[1,1,1]],
  [[1],[1],[1]],
  [[1,1,1],[0,1,0]],
  [[1,0],[1,0],[1,1]],
  [[1,1,1,1]]
];

function init() {
  board = [];
  document.getElementById("board").innerHTML = "";
  document.getElementById("pieces").innerHTML = "";
  document.getElementById("gameOverScreen").style.display = "none";

  for (let r=0;r<size;r++){
    board[r]=[];
    for(let c=0;c<size;c++){
      board[r][c]=0;
      const cell=document.createElement("div");
      cell.className="cell";
      cell.onclick=()=>tryPlace(r,c);
      document.getElementById("board").appendChild(cell);
    }
  }

  draw();
  generatePieces();
}

function draw(){
  const cells=document.querySelectorAll(".cell");
  cells.forEach((cell,i)=>{
    const r=Math.floor(i/size);
    const c=i%size;
    cell.classList.toggle("filled",board[r][c]);
  });
}

function generatePieces(){
  const container=document.getElementById("pieces");
  container.innerHTML="";
  for(let i=0;i<3;i++){
    const shape=shapes[Math.floor(Math.random()*shapes.length)];
    const div=document.createElement("div");
    div.className="piece";
    div.style.gridTemplateColumns=`repeat(${shape[0].length},22px)`;
    div._shape = shape;

    shape.forEach(row=>{
      row.forEach(cell=>{
        const block=document.createElement("div");
        block.className="block";
        if(!cell) block.style.visibility="hidden";
        div.appendChild(block);
      });
    });

    div.onclick=()=>selected={shape,el:div};
    container.appendChild(div);
  }
}

function canPlace(shape,row,col){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[0].length;c++){
      if(shape[r][c]){
        if(row+r>=size||col+c>=size||board[row+r][col+c])
          return false;
      }
    }
  }
  return true;
}

function tryPlace(row,col){
  if(!selected) return;
  if(!canPlace(selected.shape,row,col)) return;

  selected.shape.forEach((r,i)=>{
    r.forEach((val,j)=>{
      if(val) board[row+i][col+j]=1;
    });
  });

  selected.el.remove();
  selected=null;

  const cleared = clearLines();
  score += 5 + (cleared * 10);
  document.getElementById("score").textContent=score;

  draw();

  if(document.querySelectorAll(".piece").length===0)
    generatePieces();

  if(!movesAvailable())
    gameOver();
}

function clearLines(){
  let cleared=0;

  for(let r=0;r<size;r++){
    if(board[r].every(v=>v)){
      board[r]=Array(size).fill(0);
      cleared++;
    }
  }

  for(let c=0;c<size;c++){
    let full=true;
    for(let r=0;r<size;r++)
      if(!board[r][c]) full=false;

    if(full){
      for(let r=0;r<size;r++)
        board[r][c]=0;
      cleared++;
    }
  }

  return cleared;
}

function movesAvailable(){
  const pieces=document.querySelectorAll(".piece");
  for(let piece of pieces){
    const shape=piece._shape;
    for(let r=0;r<size;r++){
      for(let c=0;c<size;c++){
        if(canPlace(shape,r,c))
          return true;
      }
    }
  }
  return false;
}

function gameOver(){
  document.getElementById("finalScore").textContent=score;
  document.getElementById("gameOverScreen").style.display="flex";

  if(score>highScore){
    highScore=score;
    localStorage.setItem("bb_high",highScore);
    document.getElementById("highScore").textContent=highScore;
  }

  if(navigator.vibrate)
    navigator.vibrate(200);
}

window.restart=function(){
  score=0;
  document.getElementById("score").textContent=0;
  init();
}

init();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

});
</script>

</body>
</html>
